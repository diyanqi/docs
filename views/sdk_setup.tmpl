{% import "views/_helper.njk" as docs %}

# {{platform_name}} SDK 安装指南


{% if platform_name === ".NET" %}

这是旧版 .Net SDK 的安装指南。
旧版 .Net SDK 已停止维护，请尽快切换到 [新版 SDK](https://github.com/leancloud/csharp-sdk)。


{% endif %}

## 获取 SDK

{% if platform_name === "Objective-C" or platform_name === "Swift" or platform_name === "Python" or platform_name === "PHP" or platform_name === "Go" or platform_name === "Android / Java" or platform_name === "Flutter" %}
获取 SDK 有多种方式，较为推荐的方式是通过包依赖管理工具下载最新版本。

### 包依赖管理工具安装
{% endif %}


{% if platform_name === "Swift" %}
通过 [CocoaPods](https://cocoapods.org) 或者 [Swift Package Manager](https://developer.apple.com/documentation/swift_packages) 安装可以最大化地简化安装过程。

#### CocoaPods

首先，确保开发环境中已经安装了最新版 `pod`。如果没有，请参考官网的 [INSTALL](https://cocoapods.org) 文档。

接着，在项目根目录下通过命令行工具执行下列命令生成 `Podfile` 文件：

```sh
$ pod init
```

参考 [GET STARTED](https://cocoapods.org) 文档，在 `Podfile` 文件中的 `target` 里添加 pod 依赖：

```ruby
pod 'LeanCloud'
```

或者使用 [Subspecs](https://guides.cocoapods.org/syntax/podspec.html#subspec) 方式：

```ruby
pod 'LeanCloud/Foundation' # 数据存储、短信、推送、云引擎等基础服务模块，必选
pod 'LeanCloud/RTM'        # 即时通讯、LiveQuery 模块，可选
```

> **注意**，`LeanCloud/RTM` 依赖了 `LeanCloud/Foundation`，所以不同模块的版本号必需保持一致。

最后，在项目根目录下执行下列任意命令，集成最新的 SDK：

```sh
$ pod update
```

或者

```sh
$ pod install --repo-update
```

集成 SDK 成功后，使用项目根目录下 **`<项目名称>.xcworkspace`** 来打开项目。

#### Swift Package Manager

参考 [Apple 官方提供的集成文档](https://developer.apple.com/documentation/xcode/adding_package_dependencies_to_your_app)，添加 [Swift SDK Repo](https://github.com/leancloud/swift-sdk) 即可。
{% endif %}
{% if platform_name === "PHP" %}
#### composer

composer 是推荐的 PHP 包管理工具。安装 `leancloud-sdk` 只需执行以下命令：

```sh
composer require leancloud/leancloud-sdk
```

注意：

- `leancloud-sdk` 依赖 PHP 的 curl 扩展（常见 Linux 系统下一般需要安装 `php-curl` 这个包）。
- 如果 composer 访问 packagist 仓库有问题，需要 [设置镜像](https://mirrors.aliyun.com/composer/) 或者通过代理（设置 `http_proxy` 环境变量）访问。

{% endif %}
{% if platform_name === "Go" %}
#### Go Modules
Go SDK 支持使用官方推荐的 Go Modules 进行安装和管理，如果你的项目没有使用过 Go Modules 的话需要先用 `go mod init` 来进行初始化。

你可以先在代码中引用 Go SDK:

```go
import "github.com/leancloud/go-sdk/leancloud"
```

之后运行 `go build` 的时候就会自动下载安装 Go SDK 了。

注意：

- 如果你希望创建一个新的云引擎项目的话，推荐基于我们的 [示例项目](https://github.com/leancloud/golang-getting-started) 进行开发。
- 如果依赖下载速度较慢，可以 [配置镜像](https://goproxy.cn) 或者通过代理（设置 `http_proxy` 环境变量）访问。

{% endif %}
{% if platform_name === "Python" %}
#### pip

```sh
pip install leancloud
```

取决于系统环境，可能需要在命令前加 `sudo`。
{% endif %}


{% if platform_name === "Flutter" %}
SDK 发布在 pub.dev:
* [数据存储 SDK](https://pub.dev/packages/leancloud_storage)
* [即时通信 SDK](https://pub.dev/packages/leancloud_official_plugin)

#### 使用数据存储

在 pubspec.yaml 中，将 SDK 添加到依赖项列表:

```yaml
dependencies:
  flutter:
    sdk: flutter
  ...
  leancloud_storage: ^{{ version.flutter_storage }}
```

#### 使用即时通信

即时通信的 Flutter 插件 SDK 基于 [Swift SDK](https://github.com/leancloud/swift-sdk) 以及 [Java Unified SDK](https://github.com/leancloud/java-unified-sdk) 开发。

##### 第一步

在 pubspec.yaml 中，将 SDK 添加到依赖项列表:

```yaml
dependencies:
  flutter:
    sdk: flutter
  ...
  leancloud_official_plugin: ^{{ version.flutter_official_plugin }}
```

##### 第二步

**Android 开发者**要配置 Gradle 安装 Java Unified SDK，打开工程目录 android/app/build.gradle，添加如下依赖：

```yaml
dependencies {
  implementation 'cn.leancloud:storage-android:{{ version.unified }}'
  implementation 'cn.leancloud:realtime-android:{{ version.unified }}'
  implementation 'io.reactivex.rxjava2:rxandroid:2.1.1'
}
```
**iOS 开发者**需要通过 CocoaPods 安装 Swift SDK：

```sh
$ cd ios/
$ pod update # 或者 $ pod install --repo-update
```
{% endif %}

{% if platform_name === "Objective-C" or platform_name === "Swift" or platform_name === "Python" or platform_name === "PHP" or platform_name === "Go" or platform_name === "Android / Java" %}
### 手动安装
{% endif %}

{% if platform_name === "Python" %}
<a class="btn btn-default" target="_blank" href="https://releases.leanapp.cn/#/leancloud/python-sdk/releases">下载 SDK</a>
{% elif platform_name === "PHP" %}
<a class="btn btn-default" target="_blank" href="https://releases.leanapp.cn/#/leancloud/php-sdk/releases">下载 SDK</a>
{% elif platform_name === "Go" %}
<a class="btn btn-default" target="_blank" href="https://releases.leanapp.cn/#/leancloud/go-sdk/releases">下载 SDK</a>
{% elif platform_name === "Android / Java" or platform_name === "Objective-C" %}
<a class="btn btn-default" target="_blank" href="sdk_down.html">下载 SDK</a>
{% endif %}



{% if platform_name === "Swift" %}
> 下载 Swift SDK 源码后，也需要等待 Swift Package Manager 下载并集成其它依赖，所以推荐直接使用 Swift Package Manager。
{% endif %}

{% if platform_name === "JavaScript" %}
{{ docs.defaultLang('存储服务') }}

本指南按照应用的适用平台来介绍各自的安装与集成方式。

|[<img src="images/platforms/html5.svg" width="80"/>](#Web)|[<img src="images/platforms/node-js.svg" width="80"/>](#Node.js)|[<img src="images/platforms/weapp.svg" width="80"/>](#微信 / QQ 小程序)|[<img src="images/platforms/weapp-game.svg" width="80"/>](#微信 / QQ 小游戏)|[<img src="images/platforms/alipay-mini-app.png" width="65"/>](#支付宝小程序)|[<img src="images/platforms/baidu-mini-app.png" width="65"/>](#百度小程序)|[<img src="images/platforms/toutiao-mini-app.png" width="65"/>](#字节跳动小程序)|[<img src="images/platforms/cocos.png" width="80"/>](#CocosCreator)|[<img src="images/platforms/laya.png" width="80"/>](#LayaAir)|[<img src="images/platforms/quickapp.png" width="80"/>](#快应用)|[<img src="images/platforms/react-native.svg" width="80"/>](#React-Native)|[<img src="images/platforms/electron.svg" width="80"/>](#Electron)|[<img src="images/platforms/other.svg" width="80"/>](#其他平台)
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|Web|Node.js|微信 / QQ 小程序|微信 / QQ 小游戏|支付宝小程序|百度小程序|字节跳动小程序|CocosCreator|LayaAir|快应用|React Native|Electron|其他|

### Web

适用于运行在浏览器、WebView 或其他应用内 HTML 平台上的应用。

#### 安装与引用 SDK

##### npm

如果你的 Web 应用使用了 webpack 等前端打包工具，我们推荐使用包管理工具 npm 安装 SDK：

```存储服务
$ npm install leancloud-storage --save
```

```存储服务（LiveQuery)
$ npm install leancloud-storage --save
```

```即时通讯
$ npm install leancloud-realtime --save
```

```即时通讯（含富媒体消息）
$ npm install leancloud-realtime leancloud-realtime-plugin-typed-messages leancloud-storage --save
```

如果因为网络原因无法通过官方的 npm 站点下载，推荐通过 taobao 镜像来下载（在 `npm install` 后添加 `--registry=https://registry.npm.taobao.org` 参数）。

安装完成后，在代码中通过 `require` 获得 SDK 的引用：

```存储服务
const AV = require('leancloud-storage');
const { Query, User } = AV;
```
```存储服务（LiveQuery)
const AV = require('leancloud-storage/live-query');
const { Query, User } = AV;
```
```即时通讯
const { Realtime, TextMessage } = require('leancloud-realtime');
```
```即时通讯（含富媒体消息）
const AV = require('leancloud-storage');
const IM = require('leancloud-realtime');
// 富媒体消息插件包含的消息类型可以参考 [富媒体消息插件 API 文档](https://leancloud.github.io/js-realtime-sdk/plugins/typed-messages/docs/module-leancloud-realtime-plugin-typed-messages.html)。
const initPlugin = require('leancloud-realtime-plugin-typed-messages');

const { Realtime, TextMessage } = IM;
const { TypedMessagesPlugin, ImageMessage } = initPlugin(AV, IM);
```

{{ docs.langSpecStart('即时通讯 即时通讯（含富媒体消息）') }}
为了保证兼容性，SDK 一直以来分发的都是 ECMAScript 5 版本的代码，并打包了所有需要的 Polyfills（比如 Promise）。
即时通讯 SDK v5.0.0-rc.2 起同时提供以最新版本 ECMAScript 为编译目标的版本，该版本拥有更小的体积与更好的运行时优化，适用于只需要兼容最新版本浏览器的使用场景。
如果应用使用了 `@babel/preset-env` 或类似方案，也可以在转译时 include 最新 ECMAScript 版本的 SDK，由应用来决定要兼容的目标运行环境。
需要注意最新版本 ECMAScript 每年都会变，而该版本的目标即是提供与最新标准对齐的代码，因此由于引入了新版本 ECMASCript 特性导致不再支持某些非最新版本的运行环境将不被视为破坏兼容性的改动。
当前 ECMAScript 的版本为 2020。

如果想要试用这一功能，可以通过以下方式引入即时通讯 SDK：

```js
const { Realtime } = require('leancloud-realtime/es-latest');
```
{{ docs.langSpecEnd('即时通讯 即时通讯（含富媒体消息）') }}

##### CDN

你也可以直接在页面中通过 `script` 标签引入我们的 SDK：


```存储服务
<script src="//code.bdstatic.com/npm/leancloud-storage@{{jssdkversion}}/dist/av-min.js"></script>
```
```存储服务（LiveQuery)
<script src="//code.bdstatic.com/npm/leancloud-storage@{{jssdkversion}}/dist/av-live-query-min.js"></script>
```
```即时通讯
<script src="//code.bdstatic.com/npm/leancloud-realtime@{{jsimsdkversion}}/dist/im-browser.min.js"></script>
```
```即时通讯（含富媒体消息）
<script src="//code.bdstatic.com/npm/leancloud-storage@{{jssdkversion}}/dist/av-min.js"></script>
<script src="//code.bdstatic.com/npm/leancloud-realtime@{{jsimsdkversion}}/dist/im-browser.min.js"></script>
<script src="//code.bdstatic.com/npm/leancloud-realtime-plugin-typed-messages@4.0.2/dist/typed-messages.min.js"></script>
```

通过这种方式引入的 SDK 可以通过全局变量 `AV` 获得引用：


```存储服务
const { Query, User } = AV;
```
```存储服务（LiveQuery)
const { Query, User } = AV;
```
```即时通讯
const { Realtime, TextMessage } = AV;
```
```即时通讯（含富媒体消息）
const { Realtime, TextMessage, TypedMessagesPlugin, ImageMessage } = AV;
```

{{ docs.langSpecStart('即时通讯') }}
如果想要试用以最新版本 ECMAScript 为编译目标的即时通讯 SDK 版本（参见 [npm](#npm) 章节的说明），可以这样加载文件：

```html
<script src="//code.bdstatic.com/npm/leancloud-realtime@{{jsimsdkversion}}/dist/es-latest/im.js"></script>
```
{{ docs.langSpecEnd('即时通讯') }}

### Node.js

JavaScript SDK 也可以运行在 Node.js 运行环境中。如果希望在云引擎中访问我们的存储服务，请参照 [云引擎快速入门](leanengine_quickstart.html)，使用模板项目中提供的 `leanengine` 包接入存储服务。

注意，云引擎内部访问 API 是通过内网，所以不需要也不应该配置 API 自定义域名。
模板项目和[云引擎网站托管开发指南](leanengine_webhosting_guide-node.html)中的示例代码均未配置 API 自定义域名，
请勿设置 serverURL，以免变成公网访问，影响性能。
在使用命令行工具（`lean up`）本地调试云引擎托管项目时，虽然是公网访问，但命令行工具会自动设置相应的环境变量，供 SDK 访问 API，所以也不需要设置 serverURL。

#### 安装与引用 SDK

Node.js 中 SDK 的安装与引用也是通过包管理工具 npm，请参考 [npm](#npm)。

### 微信 / QQ 小程序

{{ docs.note('QQ 小程序兼容微信小程序的 API，因此两者使用同一个 SDK，安装与使用方法也是一样的。不过 QQ 小程序使用的 Adapters 与微信小程序不同，请前往 [QQ 小程序 Adapters 下载页](https://unpkg.com/browse/@leancloud/platform-adapters-qqapp/lib/) 下载。')}}

#### 手动导入文件

{{ docs.langSpecStart('存储服务') }}
前往 [存储 SDK 下载页](https://releases.leanapp.cn/#/leancloud/javascript-sdk/releases)，下载最新版本的 `av-core-min.js`，移动到 `libs` 目录。
{{ docs.langSpecEnd('存储服务') }}

{{ docs.langSpecStart('存储服务（LiveQuery)') }}
前往 [存储 SDK 下载页](https://releases.leanapp.cn/#/leancloud/javascript-sdk/releases)，下载最新版本的 `av-live-query-core-min.js`，移动到 `libs` 目录。
{{ docs.langSpecEnd('存储服务（LiveQuery)') }}

{{ docs.langSpecStart('即时通讯') }}
前往 [即时通讯 SDK 下载页](https://releases.leanapp.cn/#/leancloud/js-realtime-sdk/releases)，下载最新版本的 `im.min.js`，移动到 `libs` 目录。
{{ docs.langSpecEnd('即时通讯') }}

{{ docs.langSpecStart('即时通讯（含富媒体消息）') }}
前往 [存储 SDK 下载页](https://releases.leanapp.cn/#/leancloud/javascript-sdk/releases)，下载最新版本的 `av-core-min.js`，移动到 `libs` 目录，并将文件重命名为 `leancloud-storage.js`。

前往 [即时通讯 SDK 下载页](https://releases.leanapp.cn/#/leancloud/js-realtime-sdk/releases)，下载最新版本的 `im.min.js`，移动到 `libs` 目录，并将文件重命名为 `leancloud-realtime.js`。

下载 [`typed-messages.min.js`](https://code.bdstatic.com/npm/leancloud-realtime-plugin-typed-messages@4.0.2/dist/typed-messages.min.js)，移动到 `libs` 目录。
{{ docs.langSpecEnd('即时通讯（含富媒体消息）') }}

前往 [微信小程序 Adapters 下载页](https://unpkg.com/browse/@leancloud/platform-adapters-weapp/lib/)，下载最新版本的 `index.js`，移动到 `libs` 目录，并将文件重命名为 `leancloud-adapters-weapp.js`。

在 `app.js` 中引用 SDK，并设置 Adapters ：

{{ docs.note('在其他文件中引用 SDK 时请将路径替换成对应的相对路径，Adapters 仅需在 app.js 中设置。') }}

```存储服务
const AV = require('./libs/av-core-min.js');
const adapters = require('./libs/leancloud-adapters-weapp.js');

AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
const AV = require('./libs/av-live-query-core-min.js');
const adapters = require('./libs/leancloud-adapters-weapp.js');

AV.setAdapters(adapters);
```
```即时通讯
const { Realtime, TextMessage, setAdapters } = require('./libs/im.min.js');
const adapters = require('./libs/leancloud-adapters-weapp.js');

setAdapters(adapters);
```
```即时通讯（含富媒体消息）
// 需要保证依次加载三个文件
const AV = require('./libs/leancloud-storage.js');
const { Realtime, TextMessage, setAdapters } = require('./libs/leancloud-realtime.js');
const { TypedMessagesPlugin, ImageMessage } = require('./libs/typed-messages.min.js');
const adapters = require('./libs/leancloud-adapters-weapp.js');

AV.setAdapters(adapters); // 为存储 SDK 设置 adapters
setAdapters(adapters);    // 为即时通讯 SDK 设置 adapters
```

#### WePY

如果使用 [WePY](https://tencent.github.io/wepy/) 来开发小程序，可以直接通过 npm 安装和引用 SDK，具体操作步骤请参考 [npm](#npm)。

#### mpvue

如果使用 [mpvue](http://mpvue.com/) 来开发小程序，可以直接通过 npm 安装和引用 SDK，具体操作步骤请参考 [npm](#npm)。

#### Taro

如果使用 [Taro](https://taro.jd.com/) 来开发小程序，通过 npm 安装 SDK 后，需要从指定路径引入小程序 SDK：

```js
import AV from 'leancloud-storage/dist/av-weapp.js';
```

如果使用 TypeScript 开发，可以手动把 `leancloud-storage/storage.d.ts` 复制到 `leancloud-storage/dist/av-live-query-weapp.d.ts`。

#### 小程序插件

小程序插件引入 SDK 的方法与微信小程序一致。

### 微信 / QQ 小游戏

小游戏手动导入 SDK 的步骤与小程序一致，请参考 [微信 / QQ 小程序 · 手动导入文件](#手动导入文件)。

如果使用游戏引擎提供的开发工具开发小游戏，请参照对应的游戏引擎章节。

### 支付宝小程序

支付宝小程序通过 npm 安装与引用 SDK，同时由独立的 Adapters 库（@leancloud/platform-adapters-alipay）提供支持。

安装：

```存储服务
$ npm install leancloud-storage @leancloud/platform-adapters-alipay
```

```存储服务（LiveQuery)
$ npm install leancloud-storage @leancloud/platform-adapters-alipay
```

```即时通讯
$ npm install leancloud-realtime @leancloud/platform-adapters-alipay
```

```即时通讯（含富媒体消息）
$ npm install leancloud-realtime leancloud-realtime-plugin-typed-messages leancloud-storage @leancloud/platform-adapters-alipay
```

获得引用：

```存储服务
const AV = require('leancloud-storage/core');
const adapters = require('@leancloud/platform-adapters-alipay');

AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
const AV = require('leancloud-storage/live-query-core');
const adapters = require('@leancloud/platform-adapters-alipay');

AV.setAdapters(adapters);
```
```即时通讯
const { Realtime, setAdapters } = require('leancloud-realtime/im');
const adapters = require('@leancloud/platform-adapters-alipay');

setAdapters(adapters);
```
```即时通讯（含富媒体消息）
const AV = require('leancloud-storage/core');
const IM = require('leancloud-realtime/im');
const initPlugin = require('leancloud-realtime-plugin-typed-messages');
const adapters = require('@leancloud/platform-adapters-alipay');

const { Realtime, setAdapters } = IM;
const { TypedMessagesPlugin, ImageMessage } = initPlugin(AV, IM);

AV.setAdapters(adapters); // 为存储 SDK 设置 adapters
setAdapters(adapters);    // 为即时通讯 SDK 设置 adapters
```

### 百度小程序

支付宝小程序通过 npm 安装与引用 SDK，同时由独立的 Adapters 库（@leancloud/platform-adapters-baidu）提供支持。

安装：

```存储服务
$ npm install leancloud-storage @leancloud/platform-adapters-baidu
```

```存储服务（LiveQuery)
$ npm install leancloud-storage @leancloud/platform-adapters-baidu
```

```即时通讯
$ npm install leancloud-realtime @leancloud/platform-adapters-baidu
```

```即时通讯（含富媒体消息）
$ npm install leancloud-realtime leancloud-realtime-plugin-typed-messages leancloud-storage @leancloud/platform-adapters-baidu
```

获得引用：

```存储服务
const AV = require('leancloud-storage/core');
const adapters = require('@leancloud/platform-adapters-baidu');

AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
const AV = require('leancloud-storage/live-query-core');
const adapters = require('@leancloud/platform-adapters-baidu');

AV.setAdapters(adapters);
```
```即时通讯
const { Realtime, setAdapters } = require('leancloud-realtime/im');
const adapters = require('@leancloud/platform-adapters-baidu');

setAdapters(adapters);
```
```即时通讯（含富媒体消息）
const AV = require('leancloud-storage/core');
const IM = require('leancloud-realtime/im');
const initPlugin = require('leancloud-realtime-plugin-typed-messages');
const adapters = require('@leancloud/platform-adapters-baidu');

const { Realtime, setAdapters } = IM;
const { TypedMessagesPlugin, ImageMessage } = initPlugin(AV, IM);

AV.setAdapters(adapters); // 为存储 SDK 设置 adapters
setAdapters(adapters);    // 为即时通讯 SDK 设置 adapters
```

### 字节跳动小程序

{{ docs.langSpecStart('存储服务') }}
前往 [存储 SDK 下载页](https://releases.leanapp.cn/#/leancloud/javascript-sdk/releases)，下载最新版本的 `av-core-min.js`，移动到 `libs` 目录。
{{ docs.langSpecEnd('存储服务') }}

{{ docs.langSpecStart('存储服务（LiveQuery)') }}
前往 [存储 SDK 下载页](https://releases.leanapp.cn/#/leancloud/javascript-sdk/releases)，下载最新版本的 `av-live-query-core-min.js`，移动到 `libs` 目录。
{{ docs.langSpecEnd('存储服务（LiveQuery)') }}

{{ docs.langSpecStart('即时通讯') }}
前往 [即时通讯 SDK 下载页](https://releases.leanapp.cn/#/leancloud/js-realtime-sdk/releases)，下载最新版本的 `im.min.js`，移动到 `libs` 目录。
{{ docs.langSpecEnd('即时通讯') }}

{{ docs.langSpecStart('即时通讯（含富媒体消息）') }}
前往 [存储 SDK 下载页](https://releases.leanapp.cn/#/leancloud/javascript-sdk/releases)，下载最新版本的 `av-core-min.js`，移动到 `libs` 目录，并将文件重命名为 `leancloud-storage.js`。

前往 [即时通讯 SDK 下载页](https://releases.leanapp.cn/#/leancloud/js-realtime-sdk/releases)，下载最新版本的 `im.min.js`，移动到 `libs` 目录，并将文件重命名为 `leancloud-realtime.js`。

下载 [`typed-messages.min.js`](https://code.bdstatic.com/npm/leancloud-realtime-plugin-typed-messages@4.0.2/dist/typed-messages.min.js)，移动到 `libs` 目录。
{{ docs.langSpecEnd('即时通讯（含富媒体消息）') }}

前往 [字节跳动小程序 Adapters 下载页](https://code.bdstatic.com/npm/@leancloud/platform-adapters-toutiao@1.4.1/lib/index.js)，下载最新版本的 `index.js`，移动到 `libs` 目录，并将文件重命名为 `leancloud-adapters-toutiao.js`。


在 `app.js` 中引用 SDK，并设置 Adapters ：

{{ docs.note('在其他文件中引用 SDK 时请将路径替换成对应的相对路径，Adapters 仅需在 app.js 中设置。') }}

```存储服务
const AV = require('./libs/av-core-min.js');
const adapters = require('./libs/leancloud-adapters-toutiao.js');

AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
const AV = require('./libs/av-live-query-core-min.js');
const adapters = require('./libs/leancloud-adapters-toutiao.js');

AV.setAdapters(adapters);
```
```即时通讯
const { Realtime, TextMessage, setAdapters } = require('./libs/im.min.js');
const adapters = require('./libs/leancloud-adapters-toutiao.js');

setAdapters(adapters);
```
```即时通讯（含富媒体消息）
// 需要保证依次加载三个文件
const AV = require('./libs/leancloud-storage.js');
const { Realtime, TextMessage, setAdapters } = require('./libs/leancloud-realtime.js');
const { TypedMessagesPlugin, ImageMessage } = require('./libs/typed-messages.min.js');
const adapters = require('./libs/leancloud-adapters-toutiao.js');

AV.setAdapters(adapters); // 为存储 SDK 设置 adapters
setAdapters(adapters);    // 为即时通讯 SDK 设置 adapters
```

### CocosCreator

CocosCreator 支持直接通过 npm 安装与引用 SDK，具体操作步骤请参考 [npm](#npm)。

{{ docs.note("CocosCreator 项目默认没有 `package.json` 文件，可以在安装 SDK 前通过 `npm init -y` 命令创建。") }}

如果你的 CocosCreator 项目需要发布为微信或 QQ 小游戏，需要在构建发布到小游戏之前修改 SDK 的引用路径：

```存储服务
// SDK 应用路径变更为
- const AV = require('leancloud-storage');
+ const AV = require('leancloud-storage/dist/av-weapp-min.js');
```

```存储服务（LiveQuery)
// SDK 应用路径变更为
- const AV = require('leancloud-storage/live-query');
+ const AV = require('leancloud-storage/dist/av-live-query-weapp-min.js');
```

```即时通讯
// SDK 应用路径变更为
- const { Realtime } = require('leancloud-realtime');
+ const { Realtime } = require('leancloud-realtime/dist/im-weapp.js');
```

```即时通讯（含富媒体消息）
// 暂不支持
```

请注意，此改动会导致其他平台的产出（包括浏览器与模拟器的预览功能）不能正常工作，因此应该只在构建发布到小游戏之前临时修改，并在发布之后修改回来。

在改动之后，CocosCreator 的控制台可能会出现 load script error，但不影响构建发布小游戏，并且构建产出在小游戏开发工具中运行也不会有异常。

### LayaAir

LayaAir 支持直接通过 npm 安装与引用 SDK，具体操作步骤请参考 [npm](#npm)。

{{ docs.note("LayaAir 项目默认没有 `package.json` 文件，可以在安装 SDK 前通过 `npm init -y` 命令创建。") }}

如果你的 LayaAir 项目需要发布为微信或 QQ 小游戏，需要在构建发布到小游戏之前修改 SDK 的引用路径，具体替换方法请参考 [CocosCreator](#cocoscreator) 章节。

同样，此改动会导致其他平台的产出（包括浏览器与模拟器的预览功能）不能正常工作，因此应该只在构建发布到小游戏之前临时修改，并在发布之后修改回来。

### 快应用

快应用通过 npm 安装与引用 SDK，同时由独立的 Adapters 库（`@leancloud/platform-adapters-quickapp`）提供支持。

安装：

```存储服务
$ npm install leancloud-storage @leancloud/platform-adapters-quickapp --save
```

```存储服务（LiveQuery)
$ npm install leancloud-storage @leancloud/platform-adapters-quickapp --save
```

```即时通讯
$ npm install leancloud-realtime @leancloud/platform-adapters-quickapp --save
```

```即时通讯（含富媒体消息）
$ npm install leancloud-realtime leancloud-realtime-plugin-typed-messages leancloud-storage @leancloud/platform-adapters-quickapp --save
```

获得引用：

```存储服务
const AV = require('leancloud-storage/core');
const adapters = require('@leancloud/platform-adapters-quickapp');
AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
const AV = require('leancloud-storage/live-query-core');
const adapters = require('@leancloud/platform-adapters-quickapp');
AV.setAdapters(adapters);
```
```即时通讯
const { Realtime, setAdapters } = require('leancloud-realtime/im');
const adapters = require('@leancloud/platform-adapters-quickapp');
setAdapters(adapters);
```
```即时通讯（含富媒体消息）
const AV = require('leancloud-storage/core');
const IM = require('leancloud-realtime/im');
const initPlugin = require('leancloud-realtime-plugin-typed-messages');

const { Realtime, setAdapters } = IM;
const { TypedMessagesPlugin, ImageMessage } = initPlugin(AV, IM);

const adapters = require('@leancloud/platform-adapters-quickapp');
AV.setAdapters(adapters);
setAdapters(adapters);
```

### React Native

React Native 通过 npm 安装与引用 SDK，同时由独立的 Adapters 库（`@leancloud/platform-adapters-react-native`）提供支持。

安装：

```存储服务
# Step 1: Install
$ yarn add leancloud-storage @leancloud/platform-adapters-react-native @react-native-community/async-storage@1

# Step 2: Link
# For React Native 0.60+
$ npx pod-install
# For React Native <= 0.59
# npx react-native link @react-native-community/async-storage
# For Expo (SDK >= 38) 无需 link
```

```存储服务（LiveQuery)
# Step 1: Install
$ yarn add leancloud-storage @leancloud/platform-adapters-react-native @react-native-community/async-storage@1

# Step 2: Link
# For React Native 0.60+
$ npx pod-install
# For React Native <= 0.59
# npx react-native link @react-native-community/async-storage
# For Expo (SDK >= 38) 无需 link
```

```即时通讯
$ yarn add leancloud-realtime @leancloud/platform-adapters-react-native
```

```即时通讯（含富媒体消息）
# Step 1: Install
$ yarn add leancloud-realtime leancloud-realtime-plugin-typed-messages leancloud-storage @leancloud/platform-adapters-react-native @react-native-community/async-storage@1

# Step 2: Link
# For React Native 0.60+
$ npx pod-install
# For React Native <= 0.59
# npx react-native link @react-native-community/async-storage
# For Expo (SDK >= 38) 无需 link
```

获得引用：

```存储服务
import AV from 'leancloud-storage/core';
import * as adapters from '@leancloud/platform-adapters-react-native';
AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
import AV from 'leancloud-storage/live-query-core';
import * as adapters from '@leancloud/platform-adapters-react-native';
AV.setAdapters(adapters);
```
```即时通讯
import { Realtime, setAdapters } from 'leancloud-realtime/im';
import * as adapters from '@leancloud/platform-adapters-react-native';
setAdapters(adapters);
```
```即时通讯（含富媒体消息）
import AV from 'leancloud-storage/core';
import IM from 'leancloud-realtime/im';
import initPlugin from 'leancloud-realtime-plugin-typed-messages';
import * as adapters from '@leancloud/platform-adapters-react-native';

const { Realtime, setAdapters } = IM;
const { TypedMessagesPlugin, ImageMessage } = initPlugin(AV, IM);

AV.setAdapters(adapters);
setAdapters(adapters);
```

### Electron

Electron 使用包管理工具 npm 管理依赖，你可以通过以下命令安装 SDK：


```存储服务
$ npm install leancloud-storage --save
```

```存储服务（LiveQuery)
$ npm install leancloud-storage --save
```

```即时通讯
$ npm install leancloud-realtime --save
```

```即时通讯（含富媒体消息）
$ npm install leancloud-realtime leancloud-realtime-plugin-typed-messages leancloud-storage --save
```

#### 作为浏览器脚本引入

在 index.html 中可以通过 `script` 标签引入 SDK：

```存储服务
<script src="./node_modules/leancloud-storage/dist/av-min.js"></script>
```
```存储服务（LiveQuery)
<script src="./node_modules/leancloud-storage/dist/av-live-query-min.js"></script>
```
```即时通讯
<script src="./node_modules/leancloud-realtime/dist/im-browser.min.js"></script>
```
```即时通讯（含富媒体消息）
<script src="./node_modules/leancloud-storage/dist/av-min.js"></script>
<script src="./node_modules/leancloud-realtime/dist/im-browser.min.js"></script>
<script src="./node_modules/leancloud-realtime-plugin-typed-messages/dist/typed-messages.js"></script>
```

#### 作为 Node.js 模块引入

我们推荐使用 `script` 标签引入 SDK，该方式能满足绝大部分的需求。但是如果有以下的需求，SDK 也支持通过 `require('leancloud-storage')` 方法作为 Node.js 模块引入。

- 需要在 main process 中使用 SDK
- 需要使用 Node.js 的 `Buffer` 或 `Stream` 构造 `AV.File`

{{ docs.note("通过 Node.js `require` 方法引入的 SDK 与通过浏览器 `script` 标签引入的 SDK 是两个不同的 SDK，需要各自分别初始化，并且不能混用。") }}

### 其他平台

SDK 提供了平台无关的的版本以支持其他平台。所有平台相关的 API 被抽象成了可配置的 Adapters，在目标平台引入 SDK 后还需要配置目标平台的 Adapters。假设在 npm 上存在某平台（xyz）的 adapters package（`platform-adapters-xyz`），需要通过以下方式配置 SDK：

```存储服务
const AV = require('leancloud-storage/core');
const adapters = require('platform-adapters-xyz');
AV.setAdapters(adapters);
```
```存储服务（LiveQuery)
const AV = require('leancloud-storage/live-query-core');
const adapters = require('platform-adapters-xyz');
AV.setAdapters(adapters);
```
```即时通讯
const { Realtime, setAdapters } = require('leancloud-realtime/im');
const adapters = require('platform-adapters-xyz');
setAdapters(adapters);
```
```即时通讯（含富媒体消息）
const AV = require('leancloud-storage/core');
const { Realtime, setAdapters } = require('leancloud-realtime/im');
const { TypedMessagesPlugin, ImageMessage } = require('leancloud-realtime-plugin-typed-messages');
const adapters = require('platform-adapters-xyz');
AV.setAdapters(adapters);
setAdapters(adapters);
```

对于不支持使用 npm 管理依赖的运行环境，SDK 同时也提供了预编译好的 UMD 类型文件：

```存储服务
https://code.bdstatic.com/npm/leancloud-storage@{{jssdkversion}}/dist/av-core-min.js
```
```存储服务（LiveQuery)
https://code.bdstatic.com/npm/leancloud-storage@{{jssdkversion}}/dist/av-live-query-core-min.js
```
```即时通讯
https://code.bdstatic.com/npm/leancloud-realtime@{{jsimsdkversion}}/dist/im.min.js
```
```即时通讯（含富媒体消息）
// 不支持该方式
```

开发者可以自行实现目标平台的 Adapters 来适配该平台。Adapters 的接口定义可以在 package [`@leancloud/adapter-types`](https://unpkg.com/browse/@leancloud/adapter-types/types.d.ts) 中找到。你也可以通过关键字 [`platform-adapters`](https://www.npmjs.com/search?q=keywords:platform-adapters) 查找社区中其他开发者贡献的 Adapters。
{% endif %}

{% if platform_name === ".NET" %}
### Unity

- 支持 Unity 5.3+。
<!-- 等升级 Unity 即时通讯的文档后再增加这句话 -->
<!-- - 支持 .NET 4.x。SDK 在 .NET 3.x 版本下仅做 Bug 维护，不再增加新版本，请大家尽快升级到 4.x 版本。 -->

支持使用 Unity 开发的 iOS、Android、UWP、Windows Desktop，以及网页游戏。

#### 安装数据存储

请下载 [Unity Storage](https://releases.leanapp.cn/#/leancloud/unity-sdk/releases) 最新版本的 zip 包，解压之后导入到你的 Unity 项目中。如果需要使用 LiveQuery，还需要安装下面的即时通讯 SDK。

#### 安装即时通讯

请下载 [Unity Realtime](https://releases.leanapp.cn/#/leancloud/realtime-SDK-dotNET/releases) 最新版本的 zip 包，解压之后导入到你的 Unity 项目中。

#### 依赖详解

安装包解压之后，每一个依赖的详细说明如下：

名称|模块描述
--|---
`AssemblyLister.dll`|LeanCloud 依赖检测模块，它负责检查相关依赖是否正确加载
`LeanCloud.Core.dll`|核心库，里面包含了 `AVObject` 和 `AVUser` 等所有内置类型的定义和序列化相关操作的功能
`LeanCloud.Storage.dll`|存储库，里面包含本地缓存以及 HTTP 请求发送的实现
`LeanCloud.Realtime.dll`|即时通讯库，里面包含了即时通讯协议的实现以及相关接口。存储的 LiveQuery 也依赖于这个库。

### .NET 平台

支持以下运行时：

- .NET Framework 4.5+

在 Visual Studio 执行安装 nuget 依赖：

```sh
# 安装存储，必选
PM> Install-Package LeanCloud.Storage
# 安装 LiveQuery，可选，如果需要实时数据同步功能则需要安装
PM> Install-Package LeanCloud.LiveQuery
# 安装即时通讯，可选，如果需要接入聊天则需要安装
PM> Install-Package LeanCloud.Realtime
```
{% endif %}

## 初始化

首先进入 **云服务控制台 > 设置 > 应用凭证** 来获取 **App ID**，**App Key** 以及**服务器地址**。




{% if platform_name === "Swift" %}
打开 `AppDelegate.swift` 文件，添加下列导入语句到头部：

```swift
import LeanCloud
```

然后在 `application(_:didFinishLaunchingWithOptions:)` 函数内设置 App ID，App Key 以及服务器地址：


```swift
do {
    try LCApplication.default.set(
        id: {{appid}},
        key: {{appkey}},
        serverURL: "https://please-replace-with-your-customized.domain.com")
} catch {
    print(error)
}
```

{{ docs.alert("在使用 SDK 的 API 时，请确保进行了 Application 的 ID、Key 以及 Server URL 的初始化。") }}

请将 `https://please-replace-with-your-customized.domain.com` 替换为你的应用[绑定的 API 域名](custom-api-domain-guide.html#API_域名)。

国际版应用不要求绑定自定义域名。
如果你的国际版应用（App ID 后缀为 `-MdYXbMMI`）没有绑定自定义域名，**初始化 SDK 时不用传入服务器地址参数**。
极个别　App ID　后缀不为 `-MdYXbMMI` 的国际版应用，请参见[这里的说明](custom-api-domain-guide.html#App_ID_后缀不为_-MdYXbMMI_的国际版应用如何初始化_SDK)。

```swift
//国际版应用初始化：
do {
    try LCApplication.default.set(
        id: {{appid}},
        key: {{appkey}})
} catch {
    print(error)
}
```

{% endif %}
{% if platform_name === "JavaScript" %}
无论是通过 npm 安装还是直接通过 CDN 加载，初始化的方法都是一样的。

```存储服务
AV.init({
  appId: "{{appid}}",
  appKey: "{{appkey}}",
  serverURL: "https://please-replace-with-your-customized.domain.com"
});
```

```存储服务（LiveQuery)
AV.init({
  appId: "{{appid}}",
  appKey: "{{appkey}}",
  serverURL: "https://please-replace-with-your-customized.domain.com"
});
```

```即时通讯
const realtime = new Realtime({
  appId: '{{appid}}',
  appKey: '{{appkey}}',
  server: 'https://please-replace-with-your-customized.domain.com',
});
```

```即时通讯（含富媒体消息）
const realtime = new Realtime({
  appId: '{{appid}}',
  appKey: '{{appkey}}',
  server: 'https://please-replace-with-your-customized.domain.com',
  // 初始化即时通讯服务时需要指定富媒体消息插件
  plugins: [TypedMessagesPlugin],
});
// 需要同时初始化存储服务
AV.init({
  appId: "{{appid}}",
  appKey: "{{appkey}}",
  serverURL: "https://please-replace-with-your-customized.domain.com"
});
```

请将 `https://please-replace-with-your-customized.domain.com` 替换为你的应用[绑定的 API 域名](custom-api-domain-guide.html#API_域名)。

国际版应用不要求绑定自定义域名。
如果你的国际版应用（App ID 后缀为 `-MdYXbMMI`）没有绑定自定义域名，**初始化 SDK 时不用传入服务器地址参数**。
极个别　App ID　后缀不为 `-MdYXbMMI` 的国际版应用，请参见[这里的说明](custom-api-domain-guide.html#App_ID_后缀不为_-MdYXbMMI_的国际版应用如何初始化_SDK)。

{% endif %}
{% if platform_name === "Python" %}
然后导入 `leancloud`，并调用 `init` 方法进行初始化：

```python
import leancloud

leancloud.init("{{appid}}", "{{appkey}}")
# 或者使用 Master Key
# leancloud.init("{{appid}}", master_key="{{masterkey}}")
```
{% endif %}
{% if platform_name === "PHP" %}
然后导入 `Client`，并调用 `initialize` 方法进行初始化：

```php
use \LeanCloud\Client;
// 参数依次为 App ID、App Key、Master Key
Client::initialize("{{appid}}", "{{appkey}}", "{{masterkey}}");
```

{% endif %}
{% if platform_name === "Go" %}
如果是部署到云引擎的项目，或在本地使用 `lean up` 启动项目时会自动注入环境变量，只需从环境变量创建客户端即可：

```go
client := leancloud.NewEnvClient()
```

在其他环境中，你也可以手动传入应用信息：

```go
client := leancloud.NewClient(&leancloud.ClientOptions{
  AppID:     "{{appid}}",
  AppKey:    "{{appkey}}",
  MasterKey: "{{masterkey}}",
  ServerURL: "https://please-replace-with-your-customized.domain.com",
})
```

{% endif %}

{% if platform_name === ".NET" %}
导入基础模块：

```cs
// 导入存储模块
using LeanCloud;
// 如果需要，导入聊天模块
using LeanCloud.Realtime;
```

### 数据存储初始化

在使用「数据存储」服务前，调用如下代码：


```cs
AVClient.Initialize("{{appid}}", "{{appkey}}", "https://please-replace-with-your-customized.domain.com");
```

请将 `https://please-replace-with-your-customized.domain.com` 替换为你的应用[绑定的 API 域名](custom-api-domain-guide.html#API_域名)。

国际版应用不要求绑定自定义域名。
如果你的国际版应用（App ID 后缀为 `-MdYXbMMI`）没有绑定自定义域名，**初始化 SDK 时不用传入服务器地址参数**。
极个别　App ID　后缀不为 `-MdYXbMMI` 的国际版应用，请参见[这里的说明](custom-api-domain-guide.html#App_ID_后缀不为_-MdYXbMMI_的国际版应用如何初始化_SDK)。

注意，云引擎内部访问 API 是通过内网，所以不需要也不应该配置 API 自定义域名。
模板项目和[云引擎网站托管开发指南](leanengine_webhosting_guide-dotnet.html)中的示例代码均未配置 API 自定义域名，
请勿设置 ApiServer，以免变成公网访问，影响性能。

#### LiveQuery
在安装[即时通讯 SDK](#安装即时通讯) 后，需要进入 [控制台 > 数据存储 > 服务设置](https://leancloud.cn/dashboard/storage.html?appid={{appid}}#/storage/conf)，在 **安全设置** 里面勾选 **启用 LiveQuery**，然后按照下面的代码初始化。

```cs
Websockets.Net.WebsocketConnection.Link(); // Unity 下不需要此行设置
const realtime = new AVRealtime(new AVRealtime.Configuration {
    ApplicationId = appId,
    ApplicationKey = appKey,
    RTMRouter = new Uri("https://please-replace-with-your-customized.domain.com")
});
AVLiveQuery.Channel = realtime;
```

请将 `https://please-replace-with-your-customized.domain.com` 替换为你的应用[绑定的 API 域名](custom-api-domain-guide.html#API_域名)。

国际版应用不要求绑定自定义域名。
如果你的国际版应用（App ID 后缀为 `-MdYXbMMI`）没有绑定自定义域名，**初始化 SDK 时不用传入服务器地址参数**。
极个别　App ID　后缀不为 `-MdYXbMMI` 的国际版应用，请参见[这里的说明](custom-api-domain-guide.html#App_ID_后缀不为_-MdYXbMMI_的国际版应用如何初始化_SDK)。

### 即时通讯初始化

在使用「即时通讯」服务前，调用如下代码：

```cs
const realtime = new AVRealtime(new AVRealtime.Configuration
{
    ApplicationId = "{{appid}}",
    ApplicationKey = "{{appkey}}",
    RTMRouter = new Uri("https://please-replace-with-your-customized.domain.com")
});
```

请将 `https://please-replace-with-your-customized.domain.com` 替换为你的应用[绑定的 API 域名](custom-api-domain-guide.html#API_域名)。

国际版应用不要求绑定自定义域名。
如果你的国际版应用（App ID 后缀为 `-MdYXbMMI`）没有绑定自定义域名，**初始化 SDK 时不用传入服务器地址参数**。
极个别　App ID　后缀不为 `-MdYXbMMI` 的国际版应用，请参见[这里的说明](custom-api-domain-guide.html#App_ID_后缀不为_-MdYXbMMI_的国际版应用如何初始化_SDK)。
{% endif %}

{% if platform_name === "Flutter" %}

#### 数据存储
使用 SDK 时添加下列导入语句到头部：

```dart
import 'package:leancloud_storage/leancloud.dart';
```

然后在 lib/main.dart 设置 App ID，App Key 以及服务器地址：

```dart
LeanCloud.initialize(
    '{{appid}}', '{{appkey}}',
    server: 'https://please-replace-with-your-customized.domain.com',
    queryCache: new LCQueryCache());
```

请将 `https://please-replace-with-your-customized.domain.com` 替换为你的应用[绑定的 API 域名](custom-api-domain-guide.html#API_域名)。

国际版应用不要求绑定自定义域名。
如果你的国际版应用（App ID 后缀为 `-MdYXbMMI`）没有绑定自定义域名，**初始化 SDK 时不用传入服务器地址参数**。
极个别　App ID　后缀不为 `-MdYXbMMI` 的国际版应用，请参见[这里的说明](custom-api-domain-guide.html#App_ID_后缀不为_-MdYXbMMI_的国际版应用如何初始化_SDK)。

##### Android 权限设置

别忘了在 `AndroidManifest.xml` 里声明所需的 Android 权限：

```xml
<uses-permission android:name="android.permission.INTERNET"/>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

#### 即时通信

使用 SDK 时添加下列导入语句到头部：

```dart
import 'package:leancloud_official_plugin/leancloud_plugin.dart';
```

**使用 Flutter 即时通信插件需要在 Android 和 iOS 平台分别初始化。**

##### Android 平台初始化

首先向 Application 类的 onCreate 方法添加：
```java
import cn.leancloud.LeanCloud;
import cn.leancloud.LCLogger;
import cn.leancloud.im.LCIMOptions;
import io.flutter.app.FlutterApplication;

public class MyLeanCloudApp extends FlutterApplication {
    @Override
    public void onCreate() {
        super.onCreate();
        //开启未读消息数更新通知
        LCIMOptions.getGlobalOptions().setUnreadNotificationEnabled(true);
        //开启调试日志
        LeanCloud.setLogLevel(LCLogger.Level.DEBUG);
        // 提供 this、App ID、App Key、Server Host 作为参数
        // 请将 xxx.example.com 替换为你的应用绑定的 API 域名
        LeanCloud.initialize(this, "{{appid}}", "{{appkey}}", "https://please-replace-with-your-customized.domain.com");
    }
}
```
然后指定 SDK 需要的权限并在 AndroidManifest.xml 里面声明 MyLeanCloudApp 类：

```xml
<!-- 基本模块（必须）START -->
<uses-permission android:name="android.permission.INTERNET"/>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<!-- 基本模块 END -->

<application
  …
  android:name=".MyLeanCloudApp" >

  <!-- 即时通讯和推送 START -->
  <!-- 即时通讯和推送都需要 PushService -->
  <service android:name="cn.leancloud.push.PushService"/>
  <receiver android:name="cn.leancloud.push.LCBroadcastReceiver">
    <intent-filter>
      <action android:name="android.intent.action.BOOT_COMPLETED"/>
      <action android:name="android.intent.action.USER_PRESENT"/>
      <action android:name="android.net.conn.CONNECTIVITY_CHANGE" />
    </intent-filter>
  </receiver>
  <!-- 即时通讯和推送 END -->
</application>
```
##### iOS 平台初始化

在 AppDelegate.swift 中加入如下初始化代码：

```swift
import Flutter
import LeanCloud

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
    override func application(
        _ application: UIApplication,
        didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
    ) -> Bool {
        do {
            LCApplication.logLevel = .all
            try LCApplication.default.set(
                id: "{{appid}}",
                key: "{{appkey}}",
                serverURL: "https://xxx.example.com")
            GeneratedPluginRegistrant.register(with: self)
            return super.application(application, didFinishLaunchingWithOptions: launchOptions)
        } catch {
            fatalError("\(error)")
        }
    }
}
```

{% endif %}

## 开启调试日志

在应用开发阶段，你可以选择开启 SDK 的调试日志（debug log）来方便追踪问题。调试日志开启后，SDK 会把网络请求、错误消息等信息输出到 IDE 的日志窗口，或是浏览器 Console 或是云引擎日志（如果在云引擎下运行 SDK）。


{% if platform_name === "Swift" %}
```swift
// 在 Application 初始化代码执行之前执行
LCApplication.logLevel = .all
```
{% endif %}
{% if platform_name === "JavaScript" %}
如果是在 Node.js 中运行，可以在通过在启动应用时设置环境变量来打印调试日志（下面假设启动应用的命令是 `npm start`）：

```存储服务
DEBUG=leancloud* npm start
```

```存储服务（LiveQuery)
DEBUG=leancloud*,LC* npm start
```

```即时通讯
DEBUG=LC* npm start
```

```即时通讯（含富媒体消息）
DEBUG=LC* npm start
```

如果是在浏览器中运行，可以通过设置 `localStorage` 来让日志打印到浏览器控制台：

```存储服务
localStorage.setItem('debug', 'leancloud*');
```

```存储服务（LiveQuery)
localStorage.setItem('debug', 'leancloud*,LC*');
```

```即时通讯
localStorage.setItem('debug', 'LC*');
```

```即时通讯（含富媒体消息）
localStorage.setItem('debug', 'LC*');
```

除了在 Node.js 中使用环境变量，在浏览器中使用 localStorage 启用调试模式外，新版本的 SDK 还支持在代码中启用、停用调试模式。

```存储服务
// 需要 SDK 版本 >= v3.14.0
const AV = require('leancloud-storage');
AV.debug.enable();  // 启用
AV.debug.disable(); // 停用
```

```存储服务（LiveQuery)
// 需要 SDK 版本 >= v3.14.0
const AV = require('leancloud-storage');
AV.debug.enable();  // 启用
AV.debug.disable(); // 停用
```

```即时通讯
// 需要 SDK 版本 >= v5.0.0-alpha.1
const { debug } = require('leancloud-realtime');
debug.enable();  // 启用
debug.disable(); // 停用
```

```即时通讯（含富媒体消息）
// 需要 SDK 版本 >= v5.0.0-alpha.1
const { debug } = require('leancloud-realtime');
debug.enable();  // 启用
debug.disable(); // 停用
```

{% endif %}
{% if platform_name === "Python" %}
```python
# 写在启动脚本的头部
# 如果是在云引擎环境，启动脚本是 wsgi.py
import logging

logging.basicConfig(level=logging.DEBUG)
```
{% endif %}
{% if platform_name === "PHP" %}
```php
// 放在 SDK 初始化语句 Client::initialize() 后面，只需要调用一次即可
Client::setDebug(true);
```
{% endif %}
{% if platform_name === "Go" %}
在启动程序前设置环境变量 `LEANCLOUD_DEBUG`：

```
LEANCLOUD_DEBUG=true lean up
```
{% endif %}

{% if platform_name === ".NET" %}
```cs
// 开启存储日志
AVClient.HttpLog(Debug.Log);

// 开启即时通讯日志
AVRealtime.WebSocketLog(Debug.Log);
```
{% endif %}

{% if platform_name === "Flutter" %}
数据存储服务开启调试日志：
```dart
// 在 LeanCloud.initialize 初始化之后执行
LCLogger.setLevel(LCLogger.DebugLevel);
```
即时通信服务开启调试日志方式同 Swift SDK 与 Java Unified SDK。
{% endif %}

注意，在应用发布之前，请关闭调试日志，以免暴露敏感数据。

## 验证

首先，确认本地网络环境是可以访问云端服务器的，可以执行以下命令：

```sh
curl "https://{{host}}/1.1/date"
```

`{{host}}` 为绑定的 API 自定义域名。

如果当前网络正常会返回当前时间：

```json
{"__type":"Date","iso":"2020-10-12T06:46:56.000Z"}
```

{% if platform_name === "Objective-C" %}
下面来试着向 LeanCloud 云端保存一条数据，将下面的代码拷贝到 `viewDidLoad` 方法或其它在应用运行时会被调用的方法中：

```objc
LCObject *testObject = [LCObject objectWithClassName:@"TestObject"];
[testObject setObject:@"Hello world!" forKey:@"words"];
[testObject save];
```

然后，点击 `Run` 运行调试，真机和虚拟机均可。
{% endif %}
{% if platform_name === "Swift" %}
下面来试着向 LeanCloud 云端保存一条数据，将下面的代码拷贝到 `viewDidLoad` 函数或其它在应用运行时会被调用的函数中：

```swift
do {
    let testObject = LCObject(className: "TestObject")
    try testObject.set("words", value: "Hello world!")
    let result = testObject.save()
    if let error = result.error {
        print(error)
    }
} catch {
    print(error)
}
```

然后，点击 `Run` 运行调试，真机和虚拟机均可。
{% endif %}

{% if platform_name === "JavaScript" %}
然后在项目中编写如下测试代码：

```js
const TestObject = AV.Object.extend('TestObject');
const testObject = new TestObject();
testObject.set('words', 'Hello world!');
testObject.save().then((testObject) => {
  console.log('保存成功。')
})
```

保存后运行程序。
{% endif %}
{% if platform_name === "Python" %}
然后在项目中编写如下测试代码：

```python
TestObject = leancloud.Object.extend('TestObject')
test_object = TestObject()
test_object.set('words', "Hello world!")
test_object.save()
```

保存后运行程序。
{% endif %}
{% if platform_name === "PHP" %}
然后在项目中编写如下测试代码：

```php
$testObject = new LeanObject("TestObject");
$testObject->set("words", "Hello world!");
try {
    $testObject->save();
    echo "保存成功。";
} catch (Exception $ex) {
    echo "保存失败。";
}
```

保存后运行程序。
{% endif %}
{% if platform_name === "Go" %}
然后在项目中编写如下测试代码：

```go
type TestObject struct {
  leancloud.Object
  Words        string    `json:"words"`
}

client := leancloud.NewENVClient()

testObject := TestObject{
  Words: "Hello world!",
}

ref, err := client.Class("TestObject").Create(&testObject)

if err != nil {
  panic(err)
}
```

保存后运行程序。
{% endif %}

{% if platform_name === ".NET" %}
然后在项目中编写如下测试代码：

```cs
AVObject testObject = new AVObject("TestObject");
testObject["words"] = "Hello world!";
Task saveTask = testObject.SaveAsync();
await saveTask;
```

保存后运行程序。
{% endif %}


{% if platform_name === "Flutter" %}
然后在项目 lib/main.dart 中编写如下测试代码：

```dart
LCObject object = LCObject('TestObject');
object['words'] = 'Hello world!';
await object.save();
```

保存后运行程序。
{% endif %}

然后打开 **云服务控制台 > 数据存储 > 结构化数据 > `TestObject`**，如果看到数据表中出现一行「words」列的值为「Hello world!」的数据，说明 SDK 已经正确地执行了上述代码，配置完毕。

如果控制台没有发现对应的数据，请参考 [问题排查](#问题排查)。

## 问题排查

SDK 安装指南基于当前最新版本的 SDK 编写，所以排查问题前，请先检查下安装的 SDK 是不是最新版本。

### `401 Unauthorized`

如果 SDK 抛出 `401` 异常或者查看本地网络访问日志存在：

```json
{
  "code": 401,
  "error": "Unauthorized."
}
```

则可认定为 App ID 或者 App Key 输入有误，或者是不匹配，很多开发者同时注册了多个应用，导致拷贝粘贴的时候，用 A 应用的 App ID 匹配 B 应用的 App Key，这样就会出现服务端鉴权失败的错误。

### 客户端无法访问网络

客户端尤其是手机端，应用在访问网络的时候需要申请一定的权限。

